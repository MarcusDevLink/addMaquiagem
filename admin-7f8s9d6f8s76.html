<!DOCTYPE html>
<html>

<head>
    <title>Admin - Gerenciar Produtos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            padding: 12px 25px;
            background: #c3447a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background: #a53860;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        #mensagem {
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .sucesso {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .erro {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Estilos para o upload de imagem */
        .upload-container {
            margin: 15px 0;
        }

        .image-preview {
            max-width: 300px;
            max-height: 200px;
            margin: 10px 0;
            border: 2px dashed #ddd;
            padding: 10px;
            text-align: center;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 150px;
        }

        .image-url {
            margin-top: 10px;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            word-break: break-all;
            font-size: 12px;
        }

        .copy-btn {
            margin-top: 5px;
            padding: 5px 10px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
    </style>
</head>

<body>
    <h1>üì¶ Gerenciar Produtos - Beauty Glamour</h1>

    <div id="mensagem"></div>

    <h2>‚ûï Adicionar Novo Produto</h2>
    <form id="form-produto">
        <div class="form-group"><label>Nome do Produto:</label><input type="text" name="nome" required></div>
        <div class="form-group"><label>Marca:</label><input type="text" name="marca" required></div>
        <div class="form-group"><label>Categoria:</label><input type="text" name="categoria" required
                placeholder="Ex: batom, base, skincare"></div>
        <div class="form-group"><label>Pre√ßo (R$):</label><input type="number" step="0.01" name="preco" required></div>

        <!-- √ÅREA DE UPLOAD DE IMAGEM -->
        <div class="form-group">
            <label>Imagem do Produto:</label>
            <div class="upload-container">
                <input type="file" id="imagem-upload" accept="image/*" required>
                <div class="image-preview" id="image-preview">
                    <p>Imagem preview aparecer√° aqui</p>
                </div>
                <div class="image-url" id="image-url" style="display: none;">
                    <strong>URL da Imagem:</strong>
                    <br>
                    <span id="image-url-text"></span>
                    <button type="button" class="copy-btn" onclick="copiarUrl()">Copiar URL</button>
                </div>
            </div>
        </div>

        <div class="form-group"><label>Descri√ß√£o:</label><textarea name="descricao" rows="3" required></textarea></div>
        <div class="form-group"><label>Cores (separadas por v√≠rgula):</label><input type="text" name="cores" required
                placeholder="Ex: vermelho, rosa, vinho"></div>
        <div class="form-group">
            <label>Produto em Destaque?</label>
            <select name="destaque" required>
                <option value="FALSE">N√£o</option>
                <option value="TRUE">Sim</option>
            </select>
        </div>
        <div class="form-group">
            <label>Tipo de Produto:</label>
            <select name="tipo" required>
                <option value="maquiagem">Maquiagem</option>
                <option value="cuidados">Cuidados com a Pele</option>
            </select>
        </div>

        <button type="submit" id="submit-btn">
            ‚úÖ Adicionar Produto
        </button>
    </form>

    <script>
        // Chave API do ImgBB 
        const IMGBB_API_KEY = '5a03a9b6719ffb345b0f99e24dbb6ffc'; // Voc√™ precisa criar uma conta gr√°tis no ImgBB
        const API_URL = "https://script.google.com/macros/s/AKfycby4eZMh4EIoFS6rUfioqE5IALsSAPV-HGg-Y0FlT1P8DTrurWAh3_97OBJZeyVDoUjB/exec";


        // Elementos do DOM
        const imagemUpload = document.getElementById('imagem-upload');
        const imagePreview = document.getElementById('image-preview');
        const imageUrlContainer = document.getElementById('image-url');
        const imageUrlText = document.getElementById('image-url-text');
        const submitBtn = document.getElementById('submit-btn');
        let imagemUrlGerada = '';

        // Preview da imagem
        imagemUpload.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                }
                reader.readAsDataURL(file);

                // Faz upload automaticamente quando seleciona a imagem
                fazerUploadImagem(file);
            }
        });

        // Fun√ß√£o para fazer upload da imagem para o ImgBB
        async function fazerUploadImagem(file) {
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Fazendo upload da imagem...';

                const formData = new FormData();
                formData.append('image', file);

                // Faz upload para o ImgBB
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    imagemUrlGerada = data.data.url;
                    imageUrlText.textContent = imagemUrlGerada;
                    imageUrlContainer.style.display = 'block';

                    mostrarMensagem('‚úÖ Imagem enviada com sucesso! URL gerada abaixo.', 'sucesso');
                    submitBtn.disabled = false;
                    submitBtn.textContent = '‚úÖ Adicionar Produto';
                } else {
                    throw new Error(data.error.message || 'Erro no upload da imagem');
                }

            } catch (error) {
                console.error('Erro no upload:', error);
                mostrarMensagem('‚ùå Erro ao enviar imagem: ' + error.message, 'erro');
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Adicionar Produto';
            }
        }

        // Fun√ß√£o para copiar URL
        function copiarUrl() {
            navigator.clipboard.writeText(imagemUrlGerada)
                .then(() => {
                    const btn = document.querySelector('.copy-btn');
                    const originalText = btn.textContent;
                    btn.textContent = '‚úì Copiado!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('Erro ao copiar:', err);
                });
        }

        // Fun√ß√£o para mostrar mensagens
        function mostrarMensagem(texto, tipo) {
            const div = document.getElementById('mensagem');
            div.textContent = texto;
            div.className = tipo;
            div.style.display = 'block';

            setTimeout(() => {
                div.style.display = 'none';
            }, 5000);
        }

        // Quando enviar o formul√°rio
        document.getElementById('form-produto').addEventListener('submit', async function (e) {
            e.preventDefault();

            if (!imagemUrlGerada) {
                mostrarMensagem('‚ùå Por favor, aguarde o upload da imagem concluir.', 'erro');
                return;
            }

            const formData = new FormData(this);
            const produtoData = Object.fromEntries(formData.entries());

            // Adiciona a URL da imagem aos dados do produto
            produtoData.imagem = imagemUrlGerada;

            // Mostrar loading no bot√£o
            submitBtn.disabled = true;
            submitBtn.textContent = 'Adicionando...';

            await adicionarProduto(produtoData);

            // Restaurar bot√£o
            submitBtn.disabled = false;
            submitBtn.textContent = '‚úÖ Adicionar Produto';
        });

        // Fun√ß√£o para adicionar produto (j√° existente)
        // Substitua a fun√ß√£o adicionarProduto por esta vers√£o melhorada:
        async function adicionarProduto(produtoData) {
            try {
                // Remove o proxy e usa a URL diretamente (o GAS j√° tem CORS configurado)
                const response = await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Modo no-cors para evitar problemas
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(produtoData)
                });

                // Como estamos usando no-cors, n√£o podemos ler a resposta diretamente
                // Mas assumimos que foi bem-sucedido se n√£o houver erro de rede
                mostrarMensagem('‚úÖ Produto adicionado com sucesso!', 'sucesso');

                // Limpa o formul√°rio
                document.getElementById('form-produto').reset();
                imagePreview.innerHTML = '<p>Imagem preview aparecer√° aqui</p>';
                imageUrlContainer.style.display = 'none';
                imagemUrlGerada = '';

            } catch (error) {
                console.error('Erro:', error);
                mostrarMensagem('‚ùå Erro ao adicionar produto: ' + error.message, 'erro');
            }
        }

        // Link para visualizar a planilha completa
        const linkPlanilha = document.createElement('p');
        linkPlanilha.innerHTML = `<a href="https://docs.google.com/spreadsheets/d/1BGH1LrS1d_tU4xWhf4PPlsVN0WPb1-yyah1aUKZPBd4/edit?gid=0#gid=0" target="_blank" style="color: #c3447a;">üìä Ver planilha completa de produtos</a>`;
        document.body.appendChild(linkPlanilha);
    </script>
</body>

</html>